# Лекция: Поиск генов в геномах бактерий

## Введение в курс

**Алексей Комиссаров:** Приветики! Давайте минутку и начнем. Пока все подходят.

Концепция у нас немножко пролетарская будет. И даже не только про геномику, а вообще про общий подход. Изначально концепция всего аглаба немножко отличалась от той, как она есть сейчас. Она сейчас стала более институт биоинформатики. А изначально концепция была про рок-н-ролл и писать больше ручками софт, а не использовать уже готовые инструменты. 

Я хочу показать как раз вам эту концепцию, что мы можем многие вещи делать кодом, а не пытаться использовать другие инструменты.

Давайте начнем с того, чтобы вы немножко расскажете о себе, чтобы у нас был какой-то общий контекст.

## Знакомство со студентами

**Студент:** Меня зовут Маргарита, я в прошлом врач, я десять лет отработала врачом, пока работала врачом и писала диссертацию, увлеклась статистикой, закончила школу программирования двадцать один. Потом я закончила курс переподготовки на биоинформатика, сейчас учусь в магистратуре. Но работаю я медицинским аналитиком.

**Алексей Комиссаров:** Спасибо. Следующий?

**Студент:** Здравствуйте, у меня достаточно скомканный бэкграунд, потому что я пищевой технолог, бакалавриат, потом поступила на фудтех в факультете биотехнологий. Параллельно заканчивала тоже переподготовку по биоинформатике. Там же познакомилась с Анной Попенко, которая была еще в прошлом в прикладной геномике. И как-то так получилось, что я захотела отчислиться с фудтеха и поступить сюда, на прикладную геномику.

**Студент:** У меня бэкграунд немножко странноватый. Когда я поступил на биологию, профиль биохимия, я в итоге где-то с третьего курса начал заниматься биоинформатикой, начал участвовать во всяких хакатонах и турнирах. И мне просто показалось, что это направление более интересное, более востребованное. И поэтому в итоге последние два курса я занимался только биоинформатикой. Диплом писал по ML в биоинформатике с древними геномами. В итоге мой бэкграунд весь, как по программированию, так и по биоинформатике, в основном по транскриптомике, он сложился из всяких внеучебных активностей, типа турниров, хакатонов и просто каких-то сторонних проектов.

**Студент:** Я закончила аграрный университет, изучала селекцию и генетику сельскохозяйственных растений, после этого работала в Россельхознадзоре, затем поменяла место работы, заинтересовалась биоинформатикой, поступила в магистратуру.

**Алексей Комиссаров:** А что именно заинтриговало в биоинформатике?

**Студент:** Возможность продолжать работать в области, которая мне интересна, это стык генетики и ботаники, наверное, больше. И минимум контакта с людьми.

[Продолжают представляться остальные студенты с различными бэкграундами: биология, ветеринария, биоинженерия, микробиология]

## Основная часть: Поиск генов в бактериальных геномах

**Алексей Комиссаров:** Хорошо. Теперь к основной теме. Если кто-то может рассказать кратко, про что вам рассказывал вчера Федя - он должен был рассказать про гены?

**Студент:** Ну, например, стэкинг, водородные связи, ковалентные связи, частичные заряды. B-ДНК, A-ДНК, Z-ДНК. РНК, малая бороздка, большая бороздка.

**Алексей Комиссаров:** По молекулярной биологии, вы до динамики дошли вчера?

**Студент:** Лекция позиционировалась как лекция по молекулярной биологии, которая объясняет эти моменты для тех, у кого не было курса по биологии, которая касалась этих всех нюансов именно биохимии.

### Философский вопрос биоинформатики

**Алексей Комиссаров:** Есть очень интересное упражнение про молекулярную биологию. У нас есть предобученные языковые модели, например, от Сбербанка. И что мы хотим? Мы хотим сделать так, чтобы эта модель могла предсказывать физические свойства ДНК. Температуру плавления предсказывать, предсказывать гибкость. 

И вот в этом месте вы неизбежно разбираетесь во всем устройстве ДНК, потому что вы начинаете использовать маленькие и большие бороздки, для вас начинают быть фичами, чтобы объяснить модели, как что предсказывать.

Тут возникает вопрос, а что вообще мы можем узнать, только если у нас есть буквы? Это такой фундаментальный вопрос геномной биоинформатики, потому что зачастую данных, собственно, букв не хватает. Можно ли из текста сделать геном? Скорее всего, нет. Хотя есть люди, которые утверждают, что текста достаточно.

Это ключевой для всей биоинформатики вопрос: насколько какие нам нужны данные, чтобы делать научные новые открытия. То есть хватает ли нам вообще текста или нам нужен транскриптом, когда нам нужно получить метаболом, когда нам нужно поставить ChIP-seq, получить трехмерную структуру.

### Практическая задача: поиск генов в E. coli

**Алексей Комиссаров:** На сегодня мы начнем с такого упражнения. Мы попытаемся в ДНК найти гены. У нас такая задача - мы начнем не с эукариот, мы начнем с прокариот. Я вас не буду спрашивать, чем эукариоты отличаются от прокариот, потому что это глупый вопрос. А мы к нему придем просто экспериментально.

Это классическое упражнение в биоинформатике - взять прокариотический геном и прочитать его код и увидеть, что в проке все очень плохо. В какой-то момент начинается жуткий треш. Классическая биоинформатика - когда автор начинает писать код, потом устает, и там начинается жуткий треш. 

У нас есть геном Escherichia coli, и мы хотим в ней найти все гены. Как? Какое у нас будет базовое решение? Как проще всего нам найти все гены у эшерихии коли?

**Студент:** Старт-кодоном, например. Исходя из самой простой гипотезы, что ни один из генов не сломан и ни один из генов не является остаточным и уже давно не работает в геноме, можем предположить, что количество старт-кодонов будет равно или примерно равно, или как минимум не меньше, чем количество активных генов в этой бактерии.

### Работа с данными NCBI

**Алексей Комиссаров:** Давайте попробуем. У меня есть экспериментальный вариант. У нас входная точка обычно всегда NCBI - самый простой способ войти. Есть очень понятный стек - это Google Colab. В России все еще работают с ним, все хорошо.

Только очень важно эти питоновские ноутбуки хранить и их не терять. Из таких типичных ошибок - в питоновском ноутбуке удалить расширение, тогда вы его в жизни сложнее найти, чем если расширение остается.

[Демонстрация работы с NCBI, поиск и скачивание генома E. coli]

### Парсинг FASTA файлов

**Алексей Комиссаров:** У нас появляется файл FASTA. Мы, наверное, не будем сейчас писать парсер FASTA руками. Это такое любимое упражнение - было даже тестом как-то на бумаге написать парсер FASTA. Но мы попросим это сделать машину.

Напиши нам, пожалуйста, простой парсер FASTA файлов на голом питоне без каких-либо библиотек. Просто берет FASTA NCBI и выдает нам секвенс и хедер, массив секвенсов и хедеров.

У нас начинается магия искусственного интеллекта. Потому что раньше бы я пошел писать руками парсер FASTA - я писал не знаю сколько тысяч раз. Такое базовое упражнение, которое ты просто иногда пишешь, но оно полезное.

Что такое FASTA? FASTA - это блочная структура. В биоинформатике есть, наверное, два-три больших класса форматов: есть одна строка данные, они могут быть разделены чем-то, могут быть не разделены. Есть формат блока. Блок - это когда есть хедер и за хедером есть какие-то данные.

### Поиск старт-кодонов

**Алексей Комиссаров:** У нас есть гипотеза, что у нас все гены начинаются с метионина. И мы хотим посмотреть, сколько у нас вообще этих штук в секвенции.

**Студент:** Метионин же AUG в стандартной РНК. Соответственно, в ДНК это ATG должен быть.

**Алексей Комиссаров:** Отлично! Отличный вопрос. Кто-то заметил. Спасибо. Это была вторая ошибка. Не все так просто.

[Подсчет ATG в геноме]

У нас остается проблема - у нас есть реверс-комплемент. У нас, кроме собственно ДНК, у нас есть еще реверс-комплемент. Гены могут быть на обоих стрэндах.

### Проблемы наивного подхода

**Студент:** Метионин же может быть и в середине, он же не только в начале может быть, если мы посчитали все подряд, то поэтому такое число.

**Алексей Комиссаров:** Хорошо. У гена есть еще одна вещь кроме старта - у него еще есть конец.

**Студент:** Должен быть конец. И рамка считывания не должна быть сломана. То есть это еще могут быть псевдогены, которые, может быть, и начинают экспрессию, но ее не заканчивают. И, соответственно, какие-то остатки от генов, от прошлых итераций эволюции E. coli тоже остаются.

### Работа с аннотацией

**Алексей Комиссаров:** У нас же есть нормальная аннотация. Давайте мы эту аннотацию возьмем и используем. Посмотрим, подглядим сначала ответ. Мы посмотрим, что там уже известно. Мы для этого возьмем GFF от генома.

[Скачивание и парсинг GFF файла]

У нас GFF - базовый формат, самый популярный после FASTA. У нас есть FASTA - это секвенции. У нас есть FASTQ - это всевозможные сырые риды. У нас есть GFF - это наша аннотация. У нас есть BED файл - это упрощенная GFF. У нас есть VCF - это усложненная BED файл с вариантами.

### Анализ распределения длин генов

**Алексей Комиссаров:** Нарисуй нам, пожалуйста, распределение длин генов в этой аннотации и укажи, какой ген самый маленький и какой самый длинный.

[Анализ показывает самый маленький ген 27 нуклеотидов, самый длинный 7000]

**Студент:** Есть определенные лимиты, потому что ген кодирует белок, белок должен состоять из нескольких аминокислот. Он не может быть из двух аминокислот.

**Алексей Комиссаров:** Когда мы с Пашей Добрыниным мучили аннотацию генома человека, там было четыре гена из двух аминокислот.

**Студент:** Они работают?

**Алексей Комиссаров:** Нет, они не работают. Ошибка аннотации.

Люди ошибаются, в аннотации куча проблем. Не нужно верить тому, что вы скачиваете. Аннотацию делали такие же люди, как мы. Зачастую ее делали студенты-аспиранты в спешке, потому что нужно было данные выложить, и из-за этого данные далеки от совершенства.

### Различие между геном и CDS

**Алексей Комиссаров:** Кто может сказать, чем ген отличается от CDS?

**Студент:** CDS - это кодирующая последовательность, абсолютно правильно.

**Студент:** Тогда ген от CDS будет отличаться тем, что в гене будут старт- и стоп-кодоны. Если мы говорим о бактериях, больше там у них вроде ничего нет. А вот у эукариот там еще всякие некодирующие элементы могут быть дополнительные.

### Поиск ORF (открытых рамок считывания)

**Алексей Комиссаров:** Мы хотим найти все возможные открытые рамки считывания, которые начинаются с метионина и заканчиваются стоп-кодоном.

[Написание алгоритма поиска ORF]

У нас возникает проблема: мы должны учитывать, что у нас есть метионин, который может быть метионином, а может быть метионином-старт-кодоном. Мы не хотим брать отрезки метионин-стоп-кодон, который находится внутри, где метионин на самом деле не старт-кодон.

**Студент:** Мы забыли о двух феноменах - рамки считывания.

**Алексей Комиссаров:** Ты забыл про рамки считывания. У нас мы можем начинать с разным сдвигом. Есть сдвиг +1, +2, +0. То есть мы один и тот же ген можем считать тремя разными способами.

### Пересекающиеся гены

**Алексей Комиссаров:** Могут ли быть пересекающиеся гены в геноме?

**Студент:** Я думаю, что нет.

**Студент:** В человеческом точно нет. В каких-нибудь вирусах? Вполне возможно.

**Алексей Комиссаров:** У нас есть пересекающиеся гены, и они у нас есть в аннотации. В оперонах гены друг на друга залазят, они буквально перекрываются. В силу того, что у бактерии геном очень компактный. Для бактерии очень дорого заниматься репликацией генома, и поэтому геном очень компактный.

### Сравнение с геномом человека

**Алексей Комиссаров:** Давайте сходим к геному человека. Геном человека, я напомню, не все люди знают, что у нас есть T2T-сборка. Сейчас есть собранные приматы и есть прямо пачка собранных людей.

[Переход к анализу человеческого генома]

Когда у вас аннотация размером как пол генома, можно начать говорить о больших данных со всеми их принципами.

### Изоформы и определение гена

**Студент:** Выходит, что изоформа - это по факту как эпигенетика? То есть эпигенетика же влияет на экспрессию гена, и по факту, если он по-разному может считываться?

**Алексей Комиссаров:** Это очень хороший вопрос. До конца мы не можем понять, какого гена, какое количество, в каких отношениях изоформы транскрибируются и потом транслируются белки, мы до конца из только ДНК не можем. А если мы говорим, что что-то мы не можем понять только из ДНК, то это можно назвать эпигенетикой. Эпигенетика - это та информация, которая закодирована поверх букв.

У нас возникает классический вопрос, который обычно на кафедре генетики везде возникает: что такое ген? Ответ: а мы не знаем, что такое ген. Нам бы очень хотелось, но мы точно сказать, что такое ген, к сожалению, не можем.

### Оценка качества предсказания

**Алексей Комиссаров:** Мы хотим посчитать accuracy, recall, precision. Мы хотим посчитать все метрики для статистики, чтобы понять, чем они отличаются.

[Расчет метрик качества]

Есть очень типичная проблема биоинформатики - проблема нолика и единички. Мы считаем, начинаем нумерацию с нолика или с единички. В GFF нумерация с единички, а мы делаем с нолика.

### Результаты и анализ ошибок

**Алексей Комиссаров:** У нас получается recall 71 процент. Я бы сказал, что у нас все не очень хорошо, но 70% - это неплохо для наивного подхода.

Мы видим, что наш алгоритм предсказывает больше генов, чем есть в референсной аннотации. У нас проблема с precision - мы находим много ложноположительных срабатываний.

### Причины ошибок

1. **Вложенные гены** - наш алгоритм не умеет искать вложенные гены
2. **Гены, начинающиеся не с метионина** - альтернативные старт-кодоны
3. **Неправильное определение старта** - нужна информация о промоторах
4. **Псевдогены** - гены, которые выглядят как гены, но не функциональны

### Направления улучшения

**Алексей Комиссаров:** Что можно сделать для улучшения:

1. **Анализ состава нуклеотидов** - гены обычно GC-богатые
2. **Поиск промоторных последовательностей** 
3. **Использование HMM** для оценки вероятности того, что предсказанный белок является валидным
4. **Анализ синонимичных кодонов** - использование транспортных РНК неравномерно
5. **Транскриптомные данные** для подтверждения экспрессии

### Философские размышления о биологии

**Алексей Комиссаров:** В биологии исключения есть вообще из любого правила. Почему математикам так сложно заниматься биологией? Потому что в биологии исключения есть из любого закона, потому что эволюция перебирает все возможные варианты.

Если вы видите где-то случайность, вы можете этот факт о том, что это неслучайно использовать для того, чтобы искать реальные биологические штуки. Если вы видите где-то случайное распределение чего-то, скорее всего, это шум. А как только начинается закономерность, скорее там что-то есть функциональное.

### Заключение и домашнее задание

**Алексей Комиссаров:** Настоящая наука начинается, когда вы закапываетесь в данные. Если вы безумно скачали файл, засунули в черный ящик, получили другой файл, засунули в следующий черный ящик, вы рискуете где-то что-то потерять. Когда вы в данные заглядываете, у вас такой проблемы нет.

**Домашнее задание:**

1. **Базовый уровень** - повторить анализ, разобраться с кодом
2. **Хороший уровень** - взять другую бактерию, повторить анализ
3. **Отличный уровень** - улучшить алгоритм (добавить фильтры по GC-составу, использовать ML модели, добавить анализ промоторов)

Дедлайн: следующий четверг. Присылать Google Colab ноутбуки.

**Студент:** А у нас всегда без перерыва будут идти пары?

**Алексей Комиссаров:** Хорошо, давайте делать перерыв. Согласен, тяжело сидеть три с половиной часа.

Всем спасибо! Я пошлю видео и транскрипт в чатик.